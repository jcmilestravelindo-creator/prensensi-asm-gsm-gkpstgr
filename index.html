<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Attendance GKPS Tangerang - Full Rembrandt Style</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html5-qrcode/2.3.8/html5-qrcode.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jsbarcode/3.11.5/JsBarcode.all.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Cinzel+Decorative:wght@400;700;900&family=Libre+Baskerville:ital,wght@0,400;0,700;1,400&display=swap');

        /* =========================================
           === GLOBAL REMBRANDT THEME STYLES ===
           ========================================= */
        
        body { 
            font-family: 'Libre Baskerville', serif;
            color: #3e2714; /* Warna tinta sepia tua */
            background-color: #1a120b; /* Sangat gelap */
            /* Latar belakang tekstur kanvas dengan pencahayaan dramatis (Vignette) */
            background-image: 
                radial-gradient(circle at 50% 30%, rgba(166, 124, 82, 0.3), rgba(0,0,0,0.95) 90%),
                url('https://www.transparenttextures.com/patterns/canvas-textured.png'); 
            background-blend-mode: soft-light;
            min-height: 100vh;
            padding-bottom: 3rem;
        }

        /* --- Typography --- */
        h1, h2, h3, .rembrandt-title {
            font-family: 'Cinzel Decorative', cursive;
            color: #d4af37; /* Emas tua */
            text-shadow: 2px 2px 4px rgba(0,0,0,0.8);
            letter-spacing: 1px;
        }
        .rembrandt-subtitle {
            color: #a67c52; /* Coklat emas pudar */
            font-style: italic;
        }
        .rembrandt-text { color: #3e2714; line-height: 1.7; }

        /* --- Main Container Card (Gilded Frame) --- */
        /* Digunakan di SEMUA tab */
        .rembrandt-card {
            /* Latar belakang perkamen tua */
            background-color: #e6d2b5;
            background-image: url('https://www.transparenttextures.com/patterns/aged-paper.png');
            background-blend-mode: multiply;
            /* Efek cahaya lilin hangat dari atas */
            background: linear-gradient(to bottom, rgba(255,220,150,0.15) 0%, rgba(0,0,0,0.2) 100%), url('https://www.transparenttextures.com/patterns/aged-paper.png'), #e6d2b5;
            background-blend-mode: normal, multiply, normal;

            border-radius: 12px;
            padding: 2.5rem;
            position: relative;
            overflow: hidden;
            
            /* Bingkai Ukiran Emas 3D menggunakan border-image */
            border: 14px solid transparent;
            /* Fallback jika gambar tidak muat */
            border-image-source: linear-gradient(45deg, #5c3c1e, #ffd700, #8c6e20, #3e2714);
            /* Gambar tekstur bingkai emas */
            border-image: url('https://i.imgur.com/XuP0b3W.png') 35 round; 
            border-image-slice: 1 fill; /* 'fill' mengisi background dengan tekstur juga */
            
            /* Bayangan Chiaroscuro yang dalam */
            box-shadow: 
                0 25px 60px rgba(0,0,0,0.95), /* Bayangan luar berat */
                inset 0 0 50px rgba(62, 39, 20, 0.8); /* Bayangan dalam */
        }
        
        /* Garis pemisah dekoratif */
        .rembrandt-divider {
            height: 2px;
            background: linear-gradient(to right, transparent, #cba434, transparent);
            margin: 1.5rem 0; opacity: 0.6;
        }

        /* --- Navigation (Antique Plaque Style) --- */
        .rembrandt-nav-container {
            background: linear-gradient(to right, #3e2714, #8c6e20, #3e2714); /* Tekstur kayu/kuningan gelap */
            border: 3px inset #5c3c1e;
            box-shadow: 0 10px 25px rgba(0,0,0,0.8), inset 0 2px 5px rgba(255,255,255,0.1);
            padding: 0.5rem; border-radius: 999px;
        }
        .nav-btn {
            transition: all 0.3s ease; display: flex; align-items: center; gap: 0.5rem;
            font-family: 'Cinzel Decorative', cursive; font-weight: 700; font-size: 0.9rem;
            border-radius: 999px; padding: 0.75rem 1.5rem;
        }
        .nav-btn.active {
            /* Emas menyala */
            background: linear-gradient(to bottom, #ffd700, #cba434); 
            color: #1a120b; border: 2px solid #3e2714;
            box-shadow: 0 2px 10px rgba(255, 215, 0, 0.4), inset 0 2px 2px rgba(255,255,255,0.4);
            text-shadow: 0 1px 0 rgba(255,255,255,0.2);
        }
        .nav-btn.inactive {
            /* Kayu gelap pudar */
            background: rgba(26, 18, 11, 0.6); color: #cba434; border: 2px solid transparent; opacity: 0.8;
        }
        .nav-btn.inactive:hover { background: rgba(26, 18, 11, 0.9); color: #ffd700; opacity: 1; }

        /* --- Buttons (Golden/Bronze Style) --- */
        .rembrandt-btn {
            background: linear-gradient(to bottom, #cba434, #8c6e20); /* Gradien Perunggu/Emas */
            border: 3px solid #3e2714;
            color: #1a120b; font-weight: 900; font-family: 'Cinzel Decorative', cursive;
            padding: 0.8rem 1.5rem; border-radius: 0.75rem;
            text-shadow: 1px 1px 0px rgba(255,255,255,0.2);
            box-shadow: 0 4px 0px #3e2714, 0 8px 15px rgba(0,0,0,0.6); /* Efek 3D Timbul */
            transition: all 0.1s; cursor: pointer;
        }
        .rembrandt-btn:hover { background: linear-gradient(to bottom, #ffd700, #cba434); transform: translateY(-2px); box-shadow: 0 6px 0px #3e2714, 0 10px 20px rgba(0,0,0,0.7); }
        .rembrandt-btn:active { transform: translateY(4px); box-shadow: 0 0px 0px #3e2714; }

        /* --- Inputs & Selects (Parchment Style) --- */
        .rembrandt-input {
            background: #f4e4c3; /* Perkamen lebih terang */
            background-image: url('https://www.transparenttextures.com/patterns/aged-paper.png');
            border: 3px solid #8c6e20;
            color: #3e2714; font-weight: 600;
            font-family: 'Libre Baskerville', serif;
            border-radius: 0.75rem; padding: 0.75rem 1rem;
            box-shadow: inset 0 2px 5px rgba(0,0,0,0.2); transition: all 0.3s;
        }
        .rembrandt-input:focus { outline: none; border-color: #ffd700; box-shadow: 0 0 15px rgba(212, 175, 55, 0.6); background-color: #fff0d0; }

        /* --- Decorative Elements --- */
        /* Ancient Seal (Pengganti Badge Modern) */
        .ancient-seal {
            position: absolute; top: 0; right: 0;
            width: 70px; height: 70px;
            background: radial-gradient(circle at 30% 30%, #e6c200, #cba434, #8c6e20);
            border-radius: 50%;
            border: 5px double #3e2714;
            box-shadow: 3px 5px 15px rgba(0,0,0,0.7);
            display: flex; align-items: center; justify-content: center; color: #3e2714;
            transform: rotate(15deg); /* Sedikit miring agar alami */
        }
        .ancient-seal svg { filter: drop-shadow(1px 1px 0 rgba(255,255,255,0.3)); }

        /* Avatars (Miniature Painting Style) */
        .rembrandt-miniature {
            width: 55px; height: 55px; border-radius: 50%;
            border: 4px solid #cba434; /* Bingkai emas */
            box-shadow: 3px 3px 8px rgba(0,0,0,0.7);
            /* Filter sepia dan kontras agar terlihat seperti lukisan minyak tua */
            filter: sepia(0.6) contrast(1.2) brightness(0.9);
            transition: all 0.3s ease; cursor: pointer;
        }
        .rembrandt-miniature:hover, .rembrandt-miniature.selected {
            transform: scale(1.15); z-index: 10;
            filter: sepia(0) contrast(1.1) brightness(1.1); /* Kembali cerah saat dipilih */
            border-color: #ffd700; box-shadow: 0 0 15px rgba(255, 215, 0, 0.6);
        }

        /* --- ID Card Preview (Aged Document Style) --- */
        .rembrandt-id-card {
            background: #f4e4c3 url('https://www.transparenttextures.com/patterns/aged-paper.png');
            background-blend-mode: multiply;
            width: 320px; height: 500px; border-radius: 15px;
            border: 8px solid #3e2714;
            outline: 4px dashed #cba434; outline-offset: -12px;
            padding: 2rem; text-align: center; color: #3e2714;
            position: relative; overflow: hidden;
            box-shadow: 0 20px 40px rgba(0,0,0,0.8);
        }
        /* Stempel lilin dekoratif di ID Card */
        .rembrandt-id-card::before, .rembrandt-id-card::after { content: ''; position: absolute; width: 80px; height: 80px; background: radial-gradient(circle, #8c2020, #5c1e1e); border-radius: 50%; border: 3px dotted #3e2714; opacity: 0.8; }
        .rembrandt-id-card::before { top: -20px; left: -20px; } .rembrandt-id-card::after { bottom: 100px; right: -30px; }

        /* --- Admin Table (Antique Ledger Style) --- */
        .rembrandt-table-container {
            background: #f4e4c3 url('https://www.transparenttextures.com/patterns/aged-paper.png');
            border: 4px solid #5c3c1e; border-radius: 8px; overflow: hidden;
            box-shadow: inset 0 0 20px rgba(0,0,0,0.3);
        }
        .rembrandt-table thead tr { background: linear-gradient(to bottom, #cba434, #8c6e20); color: #1a120b; }
        .rembrandt-table th { font-family: 'Cinzel Decorative', cursive; letter-spacing: 1px; border-bottom: 3px solid #3e2714; }
        .rembrandt-table tbody tr { border-bottom: 1px dashed #8c6e20; transition: background 0.2s; }
        .rembrandt-table tbody tr:hover { background: rgba(255, 215, 0, 0.2); }
        .rembrandt-table td { font-family: 'Libre Baskerville', serif; color: #3e2714; font-weight: 600; }

    </style>
</head>
<body class="p-4 md:p-8 md:py-12 font-serif">

    <div class="max-w-5xl mx-auto">
        <header class="text-center mb-10">
            <h1 class="text-5xl font-extrabold mb-2" style="text-shadow: 2px 2px 8px rgba(0,0,0,1);">GKPS TANGERANG</h1>
            <p class="rembrandt-subtitle text-xl">Sistem Absensi Sekolah Minggu</p>
            <div class="flex justify-center mt-4 opacity-70">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-32 text-[#cba434]" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4M7.835 4.697a3.42 3.42 0 001.946-.806 3.42 3.42 0 014.438 0 3.42 3.42 0 001.946.806 3.42 3.42 0 013.138 3.138 3.42 3.42 0 00.806 1.946 3.42 3.42 0 010 4.438 3.42 3.42 0 00-.806 1.946 3.42 3.42 0 01-3.138 3.138 3.42 3.42 0 00-1.946.806 3.42 3.42 0 01-4.438 0 3.42 3.42 0 00-1.946-.806 3.42 3.42 0 01-3.138-3.138 3.42 3.42 0 00-.806-1.946 3.42 3.42 0 010-4.438 3.42 3.42 0 00.806-1.946 3.42 3.42 0 013.138-3.138z" /></svg>
            </div>
        </header>

        <nav class="rembrandt-nav-container flex flex-wrap justify-center gap-4 mb-12 p-3 max-w-fit mx-auto z-10 relative">
            <button onclick="switchNav('home')" id="nav-home" class="nav-btn active">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path d="M10.707 2.293a1 1 0 00-1.414 0l-7 7a1 1 0 001.414 1.414L4 10.414V17a1 1 0 001 1h2a1 1 0 001-1v-2a1 1 0 011-1h2a1 1 0 011 1v2a1 1 0 001 1h2a1 1 0 001-1v-6.586l.293.293a1 1 0 001.414-1.414l-7-7z" /></svg>
                Beranda
            </button>
            <button onclick="switchNav('register')" id="nav-register" class="nav-btn inactive">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M10 9a3 3 0 100-6 3 3 0 000 6zm-7 9a7 7 0 1114 0H3z" clip-rule="evenodd" /></svg>
                Pendaftaran
            </button>
            <button onclick="switchNav('scan')" id="nav-scan" class="nav-btn inactive">
               <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M3 4a1 1 0 011-1h3a1 1 0 011 1v3a1 1 0 01-1 1H4a1 1 0 01-1-1V4zm2 2V5h1v1H5zm9-3a1 1 0 011-1h3a1 1 0 011 1v3a1 1 0 01-1 1h-3a1 1 0 01-1-1V4zm2 2V5h1v1h-1zM3 13a1 1 0 011-1h3a1 1 0 011 1v3a1 1 0 01-1 1H4a1 1 0 01-1-1v-3zm2 2v-1h1v1H5zm9-3a1 1 0 011-1h3a1 1 0 011 1v3a1 1 0 01-1 1h-3a1 1 0 01-1-1v-3zm2 2v-1h1v1h-1z" clip-rule="evenodd" /></svg>
                Scan Barcode
            </button>
            <button onclick="switchNav('admin')" id="nav-admin" class="nav-btn inactive">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M5 4a3 3 0 00-3 3v6a3 3 0 003 3h10a3 3 0 003-3V7a3 3 0 00-3-3H5zm-1 9v-1h5v2H5a1 1 0 01-1-1zm7 1h4a1 1 0 001-1v-1h-5v2zm0-4h5V8h-5v2zM9 8H4v2h5V8z" clip-rule="evenodd" /></svg>
                Data Absensi
            </button>
        </nav>

        <section id="home" class="section">
            <div class="grid md:grid-cols-2 gap-8 items-center">
                <div class="rembrandt-card text-center flex flex-col items-center justify-center">
                     <div class="ancient-seal">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-10 w-10" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14.828 14.828a4 4 0 01-5.656 0M9 10h.01M15 10h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" /></svg>
                    </div>
                    <h3 class="rembrandt-title text-2xl mb-4 pt-4" style="border-bottom: 2px solid #cba434; display: inline-block;">Selamat Hari Minggu</h3>
                    <p class="rembrandt-text mb-6 text-xl italic font-semibold">"Kiranya damai sejahtera menyertai langkahmu ke rumah Tuhan."</p>
                    <p class="rembrandt-text">Silakan tunjukkan tanda kehadiranmu (barcode) pada petugas.</p>
                    <div class="rembrandt-divider w-1/2 mx-auto"></div>
                </div>

                <div class="rembrandt-card">
                     <div class="ancient-seal" style="right: auto; left: 0; transform: rotate(-15deg);">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-10 w-10" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z" /></svg>
                    </div>
                    <h3 class="rembrandt-title text-xl text-center pt-4">Statistik Kehadiran</h3>
                    <div class="flex flex-col items-center mt-6 mb-8">
                        <span class="rembrandt-title" style="font-size: 5rem; line-height: 1; background: linear-gradient(to bottom, #ffd700, #cba434, #8c6e20); -webkit-background-clip: text; -webkit-text-fill-color: transparent; filter: drop-shadow(2px 4px 6px rgba(0,0,0,0.8));" id="stat-count">0</span>
                        <span class="rembrandt-text font-bold mt-2 text-lg">Jiwa Telah Hadir</span>
                    </div>

                    <div class="pt-4 border-t-2 border-[#cba434]/40">
                        <p class="rembrandt-text text-sm font-bold mb-4 flex items-center justify-center uppercase tracking-widest">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2 text-[#cba434]" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M4 3a2 2 0 00-2 2v10a2 2 0 002 2h12a2 2 0 002-2V5a2 2 0 00-2-2H4zm12 12H4l4-8 3 6 2-4 3 6z" clip-rule="evenodd" /></svg>
                            Galeri Kehadiran Hari Ini
                        </p>
                        <div class="flex flex-wrap gap-4 justify-center" id="today-avatars-list">
                            <span class="rembrandt-text text-sm italic opacity-60">Belum ada lukisan wajah...</span>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <section id="register" class="section hidden">
            <div class="grid md:grid-cols-2 gap-10 items-start">
                <div class="rembrandt-card">
                     <div class="ancient-seal">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-10 w-10" viewBox="0 0 20 20" fill="currentColor"><path d="M8 9a3 3 0 100-6 3 3 0 000 6zM8 11a6 6 0 016 6H2a6 6 0 016-6zM16 7a1 1 0 10-2 0v1h-1a1 1 0 100 2h1v1a1 1 0 102 0v-1h1a1 1 0 100-2h-1V7z" /></svg>
                    </div>
                    <h2 class="rembrandt-title text-3xl mb-8 pt-4">Registrasi Baru</h2>
                    <div class="space-y-6">
                        <div>
                            <label class="block text-sm font-bold rembrandt-text mb-2 uppercase tracking-wider">Nama Lengkap</label>
                            <input type="text" id="reg-name" class="rembrandt-input w-full" placeholder="Contoh: Felicia Damanik">
                        </div>
                        <div>
                            <label class="block text-sm font-bold rembrandt-text mb-2 uppercase tracking-wider">Peran</label>
                            <select id="reg-role" class="rembrandt-input w-full cursor-pointer">
                                <option value="Anak">Anak Sekolah Minggu</option>
                                <option value="Guru">Guru Sekolah Minggu</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-bold rembrandt-text mb-3 uppercase tracking-wider">Pilih Lukisan Wajah (Avatar)</label>
                            <div class="flex gap-4 mt-2 overflow-x-auto pb-4 p-2 bg-[#3e2714]/10 rounded-xl border border-[#8c6e20]/30 justify-start" id="avatar-list">
                                </div>
                        </div>
                        <div class="rembrandt-divider"></div>
                        <button onclick="registerUser()" class="rembrandt-btn w-full text-lg">Buat Tanda Pengenal</button>
                    </div>
                </div>
                
                <div id="id-card-result" class="flex flex-col items-center justify-center hidden">
                     <h3 class="rembrandt-title text-2xl mb-6">Pratinjau Dokumen</h3>
                    
                    <div class="rembrandt-id-card flex flex-col items-center">
                        <div class="mb-4 opacity-80"><svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-24 text-[#3e2714]" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6V4m0 2a2 2 0 100 4m0-4a2 2 0 110 4m-6 8a2 2 0 100-4m0 4a2 2 0 110-4m0 4v2m0-6V4m6 6v10m6-2a2 2 0 100-4m0 4a2 2 0 110-4m0 4v2m0-6V4" /></svg></div>
                        
                        <div class="text-sm font-bold tracking-[0.3em] mb-6 rembrandt-title text-[#3e2714]">GKPS TANGERANG</div>
                        
                        <div class="w-32 h-32 rounded-full border-[6px] border double border-[#8c6e20] mb-6 overflow-hidden shadow-lg relative bg-[#e6d2b5]">
                             <div class="absolute inset-0 border-4 border-[#3e2714]/30 rounded-full z-10"></div>
                            <img id="card-avatar" src="" alt="Avatar" class="w-full h-full object-cover filter sepia(0.5) contrast(1.2)">
                        </div>
                        
                        <h2 id="card-name" class="text-3xl font-extrabold uppercase leading-tight mb-2 rembrandt-title text-[#3e2714]" style="text-shadow: 1px 1px 2px rgba(255,255,255,0.5);">Nama Peserta</h2>
                        <p id="card-role" class="text-[#5c3c1e] font-bold mb-auto text-xl uppercase tracking-widest border-b-2 border-[#8c6e20] pb-1">ROLE</p>
                        
                        <div class="bg-[#f4e4c3] p-3 rounded-lg mt-6 w-full border-4 double border-[#3e2714]">
                            <svg id="barcode" class="w-full mix-blend-multiply filter contrast(150%)"></svg>
                        </div>
                    </div>
                    <button onclick="window.print()" class="mt-8 rembrandt-btn flex items-center px-8">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 mr-3" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 17h2a2 2 0 002-2v-4a2 2 0 00-2-2H5a2 2 0 00-2 2v4a2 2 0 002 2h2m2 4h6a2 2 0 002-2v-4a2 2 0 00-2-2H9a2 2 0 00-2 2v4a2 2 0 002 2zm8-12V5a2 2 0 00-2-2H9a2 2 0 00-2 2v4h10z" /></svg>
                        Cetak Dokumen
                    </button>
                </div>
            </div>
        </section>

        <section id="scan" class="section hidden">
            <div class="grid md:grid-cols-2 gap-8">
                <div class="rembrandt-card overflow-visible">
                    <div class="ancient-seal">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-10 w-10" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 9a2 2 0 012-2h.93a2 2 0 001.664-.89l.812-1.22A2 2 0 0110.07 4h3.86a2 2 0 011.664.89l.812 1.22A2 2 0 0018.07 7H19a2 2 0 012 2v9a2 2 0 01-2 2H5a2 2 0 01-2-2V9z" /><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 13a3 3 0 11-6 0 3 3 0 016 0z" /></svg>
                    </div>
                    <h2 class="rembrandt-title text-2xl mb-6 text-center pt-4">Pemindai Kehadiran</h2>
                    
                    <div class="p-4 bg-[#3e2714] rounded-[20px] shadow-[0_10px_30px_rgba(0,0,0,0.8)] border-[6px] border-[#8c6e20] relative">
                        <div class="absolute inset-0 border-[3px] border-[#cba434] rounded-[15px] pointer-events-none z-10"></div>
                        <div id="reader" class="rounded-[12px] overflow-hidden border-4 border-[#1a120b] bg-[#1a120b] filter sepia(0.3) contrast(1.1)"></div>
                    </div>

                    <div id="scan-result" class="mt-6 text-center p-4 rounded-xl hidden font-bold text-lg border-4 double shadow-lg"></div>
                </div>

                 <div class="rembrandt-card">
                    <h3 class="rembrandt-title text-xl mb-6 text-center border-b-2 border-[#cba434] pb-2 inline-block mx-auto">Catatan Terkini</h3>
                    <div class="overflow-y-auto max-h-[400px] pr-2 scrollbar-thin scrollbar-thumb-[#8c6e20] scrollbar-track-[#3e2714]/20">
                         <table class="w-full text-left">
                            <tbody id="recent-scan-table" class="divide-y divide-[#8c6e20]/30">
                                <tr><td class="text-[#3e2714] italic py-4 text-center opacity-70">Belum ada catatan hari ini.</td></tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </section>

        <section id="admin" class="section hidden">
            <div class="rembrandt-card">
                 <div class="ancient-seal">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-10 w-10" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M3 3a1 1 0 00-1 1v12a1 1 0 102 0V4a1 1 0 00-1-1zm10.293 9.293a1 1 0 001.414 1.414l3-3a1 1 0 000-1.414l-3-3a1 1 0 10-1.414 1.414L14.586 9H7a1 1 0 100 2h7.586l-1.293 1.293z" clip-rule="evenodd" /></svg>
                </div>
                <div class="flex flex-wrap justify-between items-end mb-8 pt-4">
                    <div>
                        <h2 class="rembrandt-title text-3xl">Buku Induk Kehadiran</h2>
                        <p class="rembrandt-text italic mt-2">Rekapitulasi data jemaat sekolah minggu.</p>
                    </div>
                    <button onclick="exportData()" class="mt-6 md:mt-0 rembrandt-btn flex items-center text-sm px-6 py-3 bg-gradient-to-b from-[#22c55e] to-[#166534] border-[#14532d] text-white" style="background: linear-gradient(to bottom, #4ade80, #16a34a); color: #052e16; text-shadow: none;">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M6 2a2 2 0 00-2 2v12a2 2 0 002 2h8a2 2 0 002-2V7.414A2 2 0 0015.414 6L12 2.586A2 2 0 0010.586 2H6zm5 6a1 1 0 10-2 0 1 1 0 002 0zM7 8a1 1 0 000 2h6a1 1 0 100-2H7z" clip-rule="evenodd" /></svg>
                        Unduh Arsip (CSV)
                    </button>
                </div>
                
                <div class="rembrandt-table-container shadow-xl">
                    <table class="w-full text-left rembrandt-table">
                        <thead>
                            <tr>
                                <th class="py-5 px-6 text-lg">Nama Jemaat</th>
                                <th class="py-5 px-6 text-lg">Peran</th>
                                <th class="py-5 px-6 text-lg">Waktu Kedatangan</th>
                            </tr>
                        </thead>
                        <tbody id="attendance-table-body">
                            </tbody>
                    </table>
                </div>

                <div class="mt-10 pt-6 border-t-2 border-[#3e2714]/30 flex justify-end">
                    <button onclick="clearAttendance()" class="text-[#8c2020] hover:text-[#cba434] text-sm font-bold flex items-center transition uppercase tracking-widest px-4 py-2 border-2 border-[#8c2020] hover:border-[#cba434] rounded-lg bg-[#f4e4c3]">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M9 2a1 1 0 00-.894.553L7.382 4H4a1 1 0 000 2v10a2 2 0 002 2h8a2 2 0 002-2V6a1 1 0 100-2h-3.382l-.724-1.447A1 1 0 0011 2H9zM7 8a1 1 0 012 0v6a1 1 0 11-2 0V8zm5-1a1 1 0 00-1 1v6a1 1 0 102 0V8a1 1 0 00-1-1z" clip-rule="evenodd" /></svg>
                        Hapus Seluruh Catatan
                    </button>
                </div>
            </div>
        </section>

    </div>

    <script>
        // Database Sederhana
        let users = JSON.parse(localStorage.getItem('gkps_users')) || [];
        let attendance = JSON.parse(localStorage.getItem('gkps_attendance')) || [];
        let selectedAvatar = 'https://api.dicebear.com/7.x/adventurer/svg?seed=Felix';

        // Avatar Options (Updated to Rembrandt Miniature Style)
        const avatarSeeds = ['Felix', 'Aneka', 'Boo', 'Buddy', 'Cookie', 'Daisy', 'Tigger', 'Molly', 'Coco', 'Simba', 'Ginger'];
        const avatarListDiv = document.getElementById('avatar-list');
        avatarSeeds.forEach((seed, index) => {
            const url = `https://api.dicebear.com/7.x/adventurer/svg?seed=${seed}`;
            const img = document.createElement('img');
            img.src = url;
            img.className = `rembrandt-miniature ${index === 0 ? 'selected' : ''}`;
            if (index === 0) {
                 img.style.transform = 'scale(1.15)';
                 img.style.filter = 'sepia(0) contrast(1.1) brightness(1.1)';
                 img.style.borderColor = '#ffd700';
            }

            img.onclick = () => {
                selectedAvatar = url;
                // Reset all styles
                document.querySelectorAll('#avatar-list img').forEach(i => {
                    i.classList.remove('selected');
                    i.style.transform = ''; i.style.filter = ''; i.style.borderColor = '';
                });
                // Apply selected style
                img.classList.add('selected');
                img.style.transform = 'scale(1.15)';
                img.style.filter = 'sepia(0) contrast(1.1) brightness(1.1)';
                img.style.borderColor = '#ffd700';
            };
            avatarListDiv.appendChild(img);
        });

        // Navigation Logic (Simplified for single theme)
        function switchNav(id) {
            document.querySelectorAll('.section').forEach(s => s.classList.add('hidden'));
            document.getElementById(id).classList.remove('hidden');
            
            document.querySelectorAll('.nav-btn').forEach(btn => {
                btn.classList.remove('active');
                btn.classList.add('inactive');
            });
            document.getElementById('nav-' + id).classList.remove('inactive');
            document.getElementById('nav-' + id).classList.add('active');

            if(id === 'admin') renderAttendance();
            if(id === 'home') updateStats();
            if(id === 'scan') {
                startScanner();
                renderRecentScansTable();
            } else {
                stopScanner();
            }
        }

        // Register Logic
        function registerUser() {
            const name = document.getElementById('reg-name').value;
            const role = document.getElementById('reg-role').value;
            if(!name) return alert('Mohon isi Nama Lengkap terlebih dahulu.');

            const id = 'GKPS-' + Date.now();
            const newUser = { id, name, role, avatar: selectedAvatar };
            users.push(newUser);
            localStorage.setItem('gkps_users', JSON.stringify(users));

            const resultSection = document.getElementById('id-card-result');
            resultSection.classList.remove('hidden');
            resultSection.scrollIntoView({ behavior: 'smooth' });

            document.getElementById('card-name').innerText = name;
            document.getElementById('card-role').innerText = role;
            document.getElementById('card-avatar').src = selectedAvatar;
            
            // Barcode generation - using thicker bars for antique look
            JsBarcode("#barcode", id, { format: "CODE128", width: 3, height: 70, displayValue: true, fontSize: 16, margin: 10, lineColor: "#1a120b", background: "transparent" });
            document.getElementById('reg-name').value = '';
        }

        // Scanner Logic
        let html5QrcodeScanner;
        function startScanner() {
            if(html5QrcodeScanner) return;
            // Use a slightly lower fps for a more "mechanical" feel, and specify aspect ratio
            html5QrcodeScanner = new Html5QrcodeScanner("reader", { fps: 5, qrbox: 250, aspectRatio: 1.0 });
            html5QrcodeScanner.render((decodedText) => { processAttendance(decodedText); }, (errorMessage) => {});
        }

        function stopScanner() {
            if(html5QrcodeScanner) {
                html5QrcodeScanner.clear().then(() => { html5QrcodeScanner = null; }).catch(error => { console.error("Failed to clear scanner", error); });
            }
        }

        function processAttendance(barcodeId) {
            const user = users.find(u => u.id === barcodeId);
            const resultDiv = document.getElementById('scan-result');
            resultDiv.classList.remove('hidden');

            if(user) {
                const now = new Date();
                const timeStr = now.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
                const dateStr = now.toLocaleDateString();

                const already = attendance.find(a => a.id === barcodeId && a.date === dateStr);
                if(already) {
                    // Rembrandt Warning Style
                    resultDiv.className = "mt-6 text-center p-6 rounded-xl bg-[#f4e4c3] text-[#8c2020] border-4 double border-[#8c2020] shadow-xl font-bold text-xl rembrandt-text";
                    resultDiv.innerHTML = `⚠️ <span style="font-family: 'Cinzel Decorative';">${user.name}</span> telah tercatat hadir pukul ${already.time}.`;
                } else {
                    attendance.push({ id: barcodeId, name: user.name, role: user.role, time: timeStr, date: dateStr, avatar: user.avatar });
                    localStorage.setItem('gkps_attendance', JSON.stringify(attendance));
                    // Rembrandt Success Style
                    resultDiv.className = "mt-6 text-center p-6 rounded-xl bg-[#f4e4c3] text-[#14532d] border-4 double border-[#14532d] shadow-xl font-bold text-xl rembrandt-text";
                    resultDiv.innerHTML = `✅ Selamat Datang, <span style="font-family: 'Cinzel Decorative'; font-size: 1.2em;">${user.name}</span>. Kehadiran dicatat.`;
                    renderRecentScansTable();
                }
            } else {
                // Rembrandt Error Style
                resultDiv.className = "mt-6 text-center p-6 rounded-xl bg-[#f4e4c3] text-[#8c2020] border-4 double border-[#8c2020] shadow-xl font-bold text-xl rembrandt-text";
                resultDiv.innerHTML = `❌ Dokumen tidak dikenali dalam arsip.`;
            }
             // Hide after 4 seconds to admire the style longer
             setTimeout(() => { resultDiv.classList.add('hidden'); }, 4000);
        }

        // Admin & Stats Logic (Updated for Rembrandt Table)
        function renderAttendance() {
            const tbody = document.getElementById('attendance-table-body');
            tbody.innerHTML = '';
            if(attendance.length === 0) {
                tbody.innerHTML = '<tr><td colspan="3" class="text-center py-8 text-[#8c6e20] italic text-lg opacity-70">Buku induk masih kosong.</td></tr>';
                return;
            }
            attendance.slice().reverse().forEach(record => {
                tbody.innerHTML += `
                    <tr class="transition-all">
                        <td class="py-4 px-6 flex items-center border-r-2 border-[#8c6e20]/30">
                             <img src="${record.avatar || 'https://api.dicebear.com/7.x/adventurer/svg?seed=default'}" class="w-12 h-12 rounded-full mr-4 border-4 double border-[#cba434] filter sepia(0.4) shadow-sm">
                            <span class="text-lg">${record.name}</span>
                        </td>
                        <td class="py-4 px-6 border-r-2 border-[#8c6e20]/30">
                            <span class="px-4 py-1 rounded-full text-sm font-bold border-2 ${record.role === 'Guru' ? 'bg-[#3e2714] text-[#ffd700] border-[#cba434]' : 'bg-[#14532d] text-[#86efac] border-[#22c55e]'} style="box-shadow: inset 0 2px 5px rgba(0,0,0,0.3); text-shadow: 1px 1px 0 rgba(0,0,0,0.5);">
                                ${record.role.toUpperCase()}
                            </span>
                        </td>
                        <td class="py-4 px-6 text-[#5c3c1e] font-bold font-mono text-lg">${record.date} - ${record.time}</td>
                    </tr>
                `;
            });
        }

        function updateStats() {
            const today = new Date().toLocaleDateString();
            const todayAttendance = attendance.filter(a => a.date === today);
            document.getElementById('stat-count').innerText = todayAttendance.length;

            const avatarsContainer = document.getElementById('today-avatars-list');
            avatarsContainer.innerHTML = '';
            
            if(todayAttendance.length > 0) {
                const uniqueAvatars = [...new Map(todayAttendance.map(item => [item.avatar, item])).values()];
                uniqueAvatars.slice(0, 10).forEach(record => {
                     const img = document.createElement('img');
                     img.src = record.avatar;
                     img.className = "rembrandt-miniature tooltip";
                     img.title = record.name;
                     avatarsContainer.appendChild(img);
                });
                if(todayAttendance.length > 10) {
                     const more = document.createElement('span');
                     more.className = "flex items-center justify-center w-14 h-14 rounded-full bg-[#cba434] text-[#3e2714] font-bold text-lg border-4 double border-[#3e2714] shadow-lg rembrandt-title";
                     more.innerText = `+${todayAttendance.length - 10}`;
                     avatarsContainer.appendChild(more);
                }
            } else {
                 avatarsContainer.innerHTML = '<span class="rembrandt-text text-lg italic opacity-60 font-semibold">Belum ada lukisan wajah yang hadir...</span>';
            }
        }

        function renderRecentScansTable() {
            const today = new Date().toLocaleDateString();
            const recentTbody = document.getElementById('recent-scan-table');
            recentTbody.innerHTML = '';
            const todayTodays = attendance.filter(a => a.date === today).reverse().slice(0, 5);
            if(todayTodays.length === 0) {
                 recentTbody.innerHTML = '<tr><td class="text-[#5c3c1e] italic py-4 text-center opacity-70 font-semibold">Buku catatan hari ini masih bersih.</td></tr>';
            } else {
                todayTodays.forEach(record => {
                    recentTbody.innerHTML += `
                        <tr class="hover:bg-[#cba434]/20 transition"><td class="py-4 px-2 flex items-center"><img src="${record.avatar}" class="w-12 h-12 rounded-full mr-4 border-4 double border-[#8c6e20] filter sepia(0.5) shadow-md"><div><div class="font-bold text-[#3e2714] text-lg" style="font-family: 'Cinzel Decorative';">${record.name}</div><div class="text-sm text-[#8c6e20] font-bold tracking-wider">${record.role.toUpperCase()} - <span class="font-mono text-[#3e2714]">${record.time}</span></div></div></td></tr>
                    `;
                });
            }
        }

        function exportData() {
            let csv = "Nama Jemaat,Peran,Tanggal,Jam\n";
            attendance.forEach(row => { csv += `"${row.name}","${row.role}","${row.date}","${row.time}"\n`; });
            const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.setAttribute('href', url);
            a.setAttribute('download', `Arsip_Absensi_GKPS_${new Date().toLocaleDateString().replace(/\//g, '-')}.csv`);
            a.click();
        }

        function clearAttendance() {
            if(confirm('PERINGATAN: Tindakan ini akan memusnahkan seluruh catatan kehadiran dari buku induk. Apakah Anda yakin?')) {
                attendance = []; localStorage.setItem('gkps_attendance', JSON.stringify(attendance)); renderAttendance(); updateStats();
            }
        }

        // Init Landing Page
        switchNav('home');
    </script>
</body>
</html>
