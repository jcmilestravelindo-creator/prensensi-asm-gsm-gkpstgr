<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Attendance GKPS Tangerang - Edisi Profesional Ceria</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html5-qrcode/2.3.8/html5-qrcode.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jsbarcode/3.11.5/JsBarcode.all.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700;800&display=swap');

        /* =========================================
           === GAYA PROFESIONAL & CERIA TEMA ===
           ========================================= */
        
        :root {
            --color-primary: #0ea5e9; /* Biru Langit Cerah - Profesional & Tenang */
            --color-primary-dark: #0284c7;
            --color-accent: #facc15; /* Kuning Matahari - Ceria & Hangat */
            --color-bg-soft: #f0f9ff; /* Latar belakang sangat muda */
            --color-text-dark: #1e293b; /* Teks utama */
            --color-text-muted: #64748b; /* Teks sekunder */
            --card-shadow: 0 10px 30px -5px rgba(14, 165, 233, 0.15);
        }

        body { 
            font-family: 'Poppins', sans-serif;
            color: var(--color-text-dark);
            background: linear-gradient(to bottom, #e0f2fe, #f0f9ff); /* Gradien lembut dari atas */
            min-height: 100vh;
            padding-bottom: 3rem;
        }

        /* --- Typography & Headers --- */
        h1, h2, h3 { font-weight: 700; letter-spacing: -0.025em; }
        .brand-title {
            background: linear-gradient(to right, var(--color-primary-dark), var(--color-primary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            font-weight: 800;
        }

        /* --- Kartu Profesional Lembut (Soft Pro Card) --- */
        .pro-card {
            background-color: white;
            border-radius: 1.5rem; /* Sudut sangat membulat */
            padding: 2.5rem;
            box-shadow: var(--card-shadow);
            border: 1px solid #e2e8f0;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }
        .pro-card:hover {
            box-shadow: 0 20px 40px -5px rgba(14, 165, 233, 0.25);
        }

        /* --- Navigasi Pil (Pill Tabs) --- */
        .nav-container {
            background: white;
            padding: 0.5rem;
            border-radius: 9999px;
            box-shadow: 0 4px 15px -3px rgba(0,0,0,0.1);
            display: inline-flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 0.5rem;
        }
        .nav-btn {
            font-weight: 600; font-size: 0.95rem;
            padding: 0.75rem 1.5rem; border-radius: 9999px;
            transition: all 0.2s ease;
            display: flex; align-items: center; gap: 0.5rem;
        }
        .nav-btn.active {
            background: var(--color-primary);
            color: white;
            box-shadow: 0 4px 12px -2px rgba(14, 165, 233, 0.5);
        }
        .nav-btn.inactive {
            background: transparent; color: var(--color-text-muted);
        }
        .nav-btn.inactive:hover { background: var(--color-bg-soft); color: var(--color-primary); }

        /* --- Elemen Formulir & Tombol --- */
        .pro-input, .pro-select {
            width: 100%; padding: 0.875rem 1.25rem;
            border: 2px solid #e2e8f0; border-radius: 1rem;
            font-family: 'Poppins', sans-serif; font-weight: 500; color: var(--color-text-dark);
            background: #f8fafc; transition: all 0.2s;
        }
        .pro-input:focus, .pro-select:focus {
            outline: none; border-color: var(--color-primary);
            background: white; box-shadow: 0 0 0 4px rgba(14, 165, 233, 0.1);
        }
        .pro-label { font-weight: 600; color: var(--color-text-dark); margin-bottom: 0.5rem; display: block; font-size: 0.9rem; }

        .pro-btn {
            background: var(--color-primary); color: white;
            font-weight: 700; padding: 1rem 2rem; border-radius: 1rem;
            width: 100%; transition: all 0.2s; border: none; cursor: pointer;
            font-size: 1rem; box-shadow: 0 4px 6px -1px rgba(14, 165, 233, 0.4);
        }
        .pro-btn:hover { background: var(--color-primary-dark); transform: translateY(-2px); box-shadow: 0 10px 15px -3px rgba(14, 165, 233, 0.5); }

        /* --- Avatar Ceria --- */
        .avatar-selection {
            width: 64px; height: 64px; border-radius: 50%;
            border: 3px solid transparent; cursor: pointer; transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            background: white; padding: 2px; box-shadow: 0 4px 6px -1px rgba(0,0,0,0.1);
        }
        .avatar-selection:hover { transform: scale(1.1); }
        .avatar-selection.selected {
            border-color: var(--color-accent); /* Highlight Kuning */
            transform: scale(1.15); box-shadow: 0 0 0 4px rgba(250, 204, 21, 0.3);
        }

        /* --- ID Card Profesional --- */
        .pro-id-card {
            width: 340px; height: 520px;
            /* Gradien Biru ke Kuning yang halus */
            background: linear-gradient(135deg, var(--color-primary-dark) 0%, var(--color-primary) 60%, var(--color-accent) 100%);
            border-radius: 1.5rem; padding: 2rem;
            color: white; text-align: center; position: relative; overflow: hidden;
            box-shadow: 0 20px 40px -10px rgba(14, 165, 233, 0.5);
        }
        /* Pola latar belakang halus */
        .pro-id-card::before {
            content: ''; position: absolute; top: 0; left: 0; right: 0; bottom: 0;
            background-image: url("data:image/svg+xml,%3Csvg width='20' height='20' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='%23ffffff' fill-opacity='0.1' fill-rule='evenodd'%3E%3Ccircle cx='3' cy='3' r='3'/%3E%3Ccircle cx='13' cy='13' r='3'/%3E%3C/g%3E%3C/svg%3E");
            opacity: 0.5;
        }
        .id-avatar-frame {
            width: 140px; height: 140px; margin: 0 auto 1.5rem;
            background: white; padding: 6px; border-radius: 50%;
            box-shadow: 0 10px 20px rgba(0,0,0,0.15);
        }
        .barcode-container {
            background: white; padding: 1rem; border-radius: 1rem;
            margin-top: 2rem; box-shadow: inset 0 2px 4px rgba(0,0,0,0.05);
        }

        /* --- Scanner & Tabel --- */
        .scanner-frame {
            border-radius: 1.5rem; overflow: hidden;
            border: 4px solid var(--color-primary-dark);
            box-shadow: 0 10px 25px -5px rgba(0,0,0,0.1);
        }
        .pro-table-container {
            border-radius: 1.5rem; overflow: hidden;
            border: 1px solid #e2e8f0;
        }
        .pro-table thead th {
            background: #f1f5f9; color: var(--color-text-muted);
            font-weight: 700; text-transform: uppercase; letter-spacing: 0.05em;
            font-size: 0.85rem; padding: 1.25rem;
        }
        .pro-table tbody td {
            padding: 1.25rem; border-top: 1px solid #f1f5f9;
            font-weight: 500;
        }
        .pro-table tbody tr:hover { background: #f8fafc; }
        
        /* Badge Peran */
        .role-badge {
            padding: 0.35rem 1rem; border-radius: 999px; font-size: 0.8rem; font-weight: 700;
        }
        .role-guru { background: #dbeafe; color: #1e40af; }
        .role-anak { background: #dcfce7; color: #166534; }

    </style>
</head>
<body class="p-4 md:p-8">

    <div class="max-w-6xl mx-auto relative z-10">
        <header class="text-center mb-10">
            <div class="flex items-center justify-center mb-4">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-12 w-12 text-blue-500 mr-3" viewBox="0 0 20 20" fill="currentColor"><path d="M10.394 2.08a1 1 0 00-.788 0l-7 3a1 1 0 000 1.84L5.25 8.051a.999.999 0 01.356-.257l4-1.714a1 1 0 11.788 1.838L7.667 9.088l1.94.831a1 1 0 00.787 0l7-3a1 1 0 000-1.838l-7-3zM3.31 9.397L5 10.12v4.102a8.969 8.969 0 00-1.05-.174 1 1 0 01-.89-.89 11.115 11.115 0 01.25-3.762zM9.3 16.573A9.026 9.026 0 007 14.935v-3.957l1.818.78a3 3 0 002.364 0l5.508-2.361a11.026 11.026 0 01.25 3.762 1 1 0 01-.89.89 8.968 8.968 0 00-5.35 2.524 1 1 0 01-1.4 0zM6 18a1 1 0 001-1v-2.065a8.935 8.935 0 00-2-.712V17a1 1 0 001 1h2z" /></svg>
                <h1 class="text-4xl md:text-5xl brand-title">GKPS TANGERANG</h1>
            </div>
            <p class="text-lg text-gray-600 font-medium">Sistem Absensi Sekolah Minggu</p>
        </header>

        <div class="flex justify-center mb-12">
            <nav class="nav-container">
                <button onclick="switchNav('home')" id="nav-home" class="nav-btn active">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path d="M10.707 2.293a1 1 0 00-1.414 0l-7 7a1 1 0 001.414 1.414L4 10.414V17a1 1 0 001 1h2a1 1 0 001-1v-2a1 1 0 011-1h2a1 1 0 011 1v2a1 1 0 001 1h2a1 1 0 001-1v-6.586l.293.293a1 1 0 001.414-1.414l-7-7z" /></svg>
                    Beranda
                </button>
                <button onclick="switchNav('register')" id="nav-register" class="nav-btn inactive">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M10 9a3 3 0 100-6 3 3 0 000 6zm-7 9a7 7 0 1114 0H3z" clip-rule="evenodd" /></svg>
                    Pendaftaran
                </button>
                <button onclick="switchNav('scan')" id="nav-scan" class="nav-btn inactive">
                   <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M3 4a1 1 0 011-1h3a1 1 0 011 1v3a1 1 0 01-1 1H4a1 1 0 01-1-1V4zm2 2V5h1v1H5zm9-3a1 1 0 011-1h3a1 1 0 011 1v3a1 1 0 01-1 1h-3a1 1 0 01-1-1V4zm2 2V5h1v1h-1zM3 13a1 1 0 011-1h3a1 1 0 011 1v3a1 1 0 01-1 1H4a1 1 0 01-1-1v-3zm2 2v-1h1v1H5zm9-3a1 1 0 011-1h3a1 1 0 011 1v3a1 1 0 01-1 1h-3a1 1 0 01-1-1v-3zm2 2v-1h1v1h-1z" clip-rule="evenodd" /></svg>
                    Scan Barcode
                </button>
                <button onclick="switchNav('admin')" id="nav-admin" class="nav-btn inactive">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M5 4a3 3 0 00-3 3v6a3 3 0 003 3h10a3 3 0 003-3V7a3 3 0 00-3-3H5zm-1 9v-1h5v2H5a1 1 0 01-1-1zm7 1h4a1 1 0 001-1v-1h-5v2zm0-4h5V8h-5v2zM9 8H4v2h5V8z" clip-rule="evenodd" /></svg>
                    Data Absensi
                </button>
            </nav>
        </div>

        <section id="home" class="section">
            <div class="grid md:grid-cols-2 gap-8 items-center">
                <div class="pro-card flex flex-col items-center text-center relative overflow-hidden">
                    <div class="absolute -top-10 -left-10 w-32 h-32 bg-yellow-300 rounded-full mix-blend-multiply filter blur-xl opacity-70 animate-blob"></div>
                    <div class="absolute -bottom-10 -right-10 w-32 h-32 bg-blue-300 rounded-full mix-blend-multiply filter blur-xl opacity-70 animate-blob animation-delay-2000"></div>
                    
                    <img src="https://cdn-icons-png.flaticon.com/512/2919/2919689.png" class="w-24 h-24 mb-6 relative z-10 drop-shadow-md" alt="Welcome Icon">
                    <h2 class="text-3xl font-extrabold mb-4 text-blue-900 relative z-10">Selamat Hari Minggu!</h2>
                    <p class="text-lg text-gray-600 mb-6 leading-relaxed relative z-10 font-medium max-w-md">
                        "Mari kita beribadah dengan sukacita. Siapkan ID Card-mu untuk absen ya!"
                    </p>
                </div>

                <div class="pro-card relative overflow-hidden">
                    <div class="flex items-center justify-between mb-8">
                        <h3 class="text-2xl font-bold text-gray-800">Kehadiran Hari Ini</h3>
                        <span class="bg-blue-100 text-blue-800 text-sm font-bold px-3 py-1 rounded-full flex items-center">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-1" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M6 2a1 1 0 00-1 1v1H4a2 2 0 00-2 2v10a2 2 0 002 2h12a2 2 0 002-2V6a2 2 0 00-2-2h-1V3a1 1 0 00-1-1H6zm1 3h6v1H7V5zm9 3V7H4v1h12zm-3 3H7v1h6v-1zm-6 3h6v1H7v-1z" clip-rule="evenodd" /></svg>
                            Minggu Ini
                        </span>
                    </div>
                    
                    <div class="flex items-baseline mb-8">
                        <span class="text-6xl font-extrabold text-blue-600 mr-3" id="stat-count">0</span>
                        <span class="text-xl text-gray-500 font-semibold">Jiwa Telah Hadir</span>
                    </div>

                    <div class="pt-6 border-t border-gray-100">
                        <p class="font-semibold text-gray-700 mb-4 flex items-center text-sm uppercase tracking-wider">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2 text-yellow-500" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd" /></svg>
                            Peserta Terbaru
                        </p>
                        <div class="flex flex-wrap gap-2" id="today-avatars-list">
                            <span class="text-gray-400 font-medium italic bg-gray-50 px-3 py-1 rounded-lg">Menunggu kehadiran pertama...</span>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <section id="register" class="section hidden">
            <div class="grid md:grid-cols-2 gap-12 items-start">
                <div class="pro-card">
                    <div class="flex items-center mb-8">
                        <div class="w-12 h-12 bg-blue-100 rounded-full flex items-center justify-center mr-4">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-blue-600" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M18 9v3m0 0v3m0-3h3m-3 0h-3m-2-5a4 4 0 11-8 0 4 4 0 018 0zM3 20a6 6 0 0112 0v1H3v-1z" /></svg>
                        </div>
                        <h2 class="text-3xl font-extrabold text-gray-800">Pendaftaran Baru</h2>
                    </div>
                    <div class="space-y-6">
                        <div>
                            <label class="pro-label">Nama Lengkap</label>
                            <input type="text" id="reg-name" class="pro-input" placeholder="Contoh: Felicia Damanik">
                        </div>
                        <div>
                            <label class="pro-label">Peran</label>
                            <div class="relative">
                                <select id="reg-role" class="pro-select appearance-none">
                                    <option value="Anak">Anak Sekolah Minggu</option>
                                    <option value="Guru">Guru Sekolah Minggu</option>
                                </select>
                                <div class="pointer-events-none absolute inset-y-0 right-0 flex items-center px-3 text-gray-500">
                                    <svg class="fill-current h-5 w-5" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20"><path d="M9.293 12.95l.707.707L15.657 8l-1.414-1.414L10 10.828 5.757 6.586 4.343 8z"/></svg>
                                </div>
                            </div>
                        </div>
                        <div>
                            <label class="pro-label mb-3">Pilih Avatar (Klik untuk memilih)</label>
                            <div class="flex gap-4 overflow-x-auto pb-4 p-2 bg-gray-50 rounded-xl border border-gray-200" id="avatar-list">
                                </div>
                        </div>
                        <button onclick="registerUser()" class="pro-btn mt-4">
                            <span class="flex items-center justify-center">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-11a1 1 0 10-2 0v2H7a1 1 0 100 2h2v2a1 1 0 102 0v-2h2a1 1 0 100-2h-2V7z" clip-rule="evenodd" /></svg>
                                Buat ID Card Sekarang
                            </span>
                        </button>
                    </div>
                </div>
                
                <div id="id-card-result" class="flex flex-col items-center justify-center hidden">
                     <h3 class="text-2xl font-bold text-blue-900 mb-6 flex items-center">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 mr-2 text-yellow-500" viewBox="0 0 20 20" fill="currentColor"><path d="M10 12a2 2 0 100-4 2 2 0 000 4z" /><path fill-rule="evenodd" d="M.458 10C1.732 5.943 5.522 3 10 3s8.268 2.943 9.542 7c-1.274 4.057-5.064 7-9.542 7S1.732 14.057.458 10zM14 10a4 4 0 11-8 0 4 4 0 018 0z" clip-rule="evenodd" /></svg>
                        Pratinjau ID Card
                    </h3>
                    
                    <div class="pro-id-card flex flex-col items-center">
                        <div class="text-sm font-bold tracking-widest mb-6 opacity-90 uppercase">GKPS TANGERANG</div>
                        
                        <div class="id-avatar-frame">
                            <img id="card-avatar" src="" alt="Avatar" class="w-full h-full rounded-full object-cover">
                        </div>
                        
                        <h2 id="card-name" class="text-3xl font-extrabold uppercase leading-tight mb-1 text-white drop-shadow-sm">Nama Peserta</h2>
                        <div class="inline-block bg-white/20 px-4 py-1 rounded-full backdrop-blur-sm">
                            <p id="card-role" class="text-yellow-300 font-bold text-sm uppercase tracking-wider">ROLE</p>
                        </div>
                        
                        <div class="barcode-container w-full">
                            <svg id="barcode" class="w-full"></svg>
                        </div>
                    </div>
                    <button onclick="window.print()" class="mt-8 bg-white text-blue-600 hover:bg-blue-50 font-bold px-8 py-4 rounded-xl shadow-md transition flex items-center border-2 border-blue-100">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 17h2a2 2 0 002-2v-4a2 2 0 00-2-2H5a2 2 0 00-2 2v4a2 2 0 002 2h2m2 4h6a2 2 0 002-2v-4a2 2 0 00-2-2H9a2 2 0 00-2 2v4a2 2 0 002 2zm8-12V5a2 2 0 00-2-2H9a2 2 0 00-2 2v4h10z" /></svg>
                        Cetak / Simpan ID Card
                    </button>
                </div>
            </div>
        </section>

        <section id="scan" class="section hidden">
            <div class="grid md:grid-cols-2 gap-10 items-start">
                <div class="pro-card">
                    <div class="text-center mb-6">
                         <div class="w-16 h-16 bg-blue-100 rounded-full flex items-center justify-center mx-auto mb-4">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8 text-blue-600" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v1m6 11h2m-6 0h-2v4m0-11v3m0 0h.01M12 12h4.01M16 20h4M4 12h4m12 0h.01M5 8h2a1 1 0 001-1V5a1 1 0 00-1-1H5a1 1 0 00-1 1v2a1 1 0 001 1zm12 0h2a1 1 0 001-1V5a1 1 0 00-1-1h-2a1 1 0 00-1 1v2a1 1 0 001 1zM5 16h2a1 1 0 001-1v-2a1 1 0 00-1-1H5a1 1 0 00-1 1v2a1 1 0 001 1z" /></svg>
                        </div>
                        <h2 class="text-2xl font-extrabold text-gray-800">Scan Barcode Kehadiran</h2>
                        <p class="text-gray-500">Arahkan kamera ke barcode pada ID Card.</p>
                    </div>
                    
                    <div class="scanner-frame bg-gray-100 relative">
                        <div id="reader"></div>
                        <div class="absolute inset-0 pointer-events-none flex items-center justify-center">
                            <div class="w-64 h-64 border-4 border-yellow-400 rounded-2xl opacity-50 border-dashed"></div>
                        </div>
                    </div>

                    <div id="scan-result" class="mt-6 text-center p-5 font-bold text-lg rounded-xl hidden shadow-md transition-all"></div>
                </div>

                 <div class="pro-card">
                    <h3 class="text-xl font-bold text-gray-800 mb-6 flex items-center pb-4 border-b border-gray-100">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2 text-blue-500" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z" clip-rule="evenodd" /></svg>
                        Scan Terbaru Hari Ini
                    </h3>
                    <div class="overflow-y-auto max-h-[500px] pr-2">
                         <table class="w-full text-left">
                            <tbody id="recent-scan-table" class="divide-y divide-gray-50">
                                <tr><td class="text-gray-400 font-medium italic py-6 text-center bg-gray-50 rounded-xl">Belum ada yang scan hari ini.</td></tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </section>

        <section id="admin" class="section hidden">
            <div class="pro-card">
                <div class="flex flex-wrap justify-between items-end mb-8">
                    <div>
                        <h2 class="text-3xl font-extrabold text-gray-800">Data Absensi</h2>
                        <p class="text-gray-500 font-medium mt-1">Rekapitulasi kehadiran jemaat.</p>
                    </div>
                    <button onclick="exportData()" class="mt-6 md:mt-0 bg-green-500 hover:bg-green-600 text-white px-6 py-3 rounded-xl font-bold shadow-sm transition flex items-center">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" /></svg>
                        Ekspor ke Excel (CSV)
                    </button>
                </div>
                
                <div class="pro-table-container overflow-x-auto">
                    <table class="w-full text-left pro-table">
                        <thead>
                            <tr>
                                <th>Nama Jemaat</th>
                                <th>Peran</th>
                                <th>Waktu Kehadiran</th>
                            </tr>
                        </thead>
                        <tbody id="attendance-table-body" class="bg-white">
                            </tbody>
                    </table>
                </div>

                <div class="mt-10 flex justify-end">
                    <button onclick="clearAttendance()" class="text-red-500 hover:text-red-700 hover:bg-red-50 px-4 py-2 rounded-lg text-sm font-bold flex items-center transition">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M9 2a1 1 0 00-.894.553L7.382 4H4a1 1 0 000 2v10a2 2 0 002 2h8a2 2 0 002-2V6a1 1 0 100-2h-3.382l-.724-1.447A1 1 0 0011 2H9zM7 8a1 1 0 012 0v6a1 1 0 11-2 0V8zm5-1a1 1 0 00-1 1v6a1 1 0 102 0V8a1 1 0 00-1-1z" clip-rule="evenodd" /></svg>
                        Hapus Semua Data
                    </button>
                </div>
            </div>
        </section>

    </div>

    <script>
        // Database Sederhana
        let users = JSON.parse(localStorage.getItem('gkps_users')) || [];
        let attendance = JSON.parse(localStorage.getItem('gkps_attendance')) || [];
        let selectedAvatar = 'https://api.dicebear.com/7.x/adventurer/svg?seed=Felix';

        // Avatar Options (Updated Style)
        const avatarSeeds = ['Felix', 'Aneka', 'Boo', 'Buddy', 'Cookie', 'Daisy', 'Tigger', 'Molly', 'Coco', 'Simba', 'Ginger', 'Lily', 'Oscar'];
        const avatarListDiv = document.getElementById('avatar-list');
        avatarSeeds.forEach((seed, index) => {
            const url = `https://api.dicebear.com/7.x/adventurer/svg?seed=${seed}`;
            const img = document.createElement('img');
            img.src = url;
            img.className = `avatar-selection ${index === 0 ? 'selected' : ''}`;
            
            img.onclick = () => {
                selectedAvatar = url;
                document.querySelectorAll('#avatar-list img').forEach(i => i.classList.remove('selected'));
                img.classList.add('selected');
            };
            avatarListDiv.appendChild(img);
        });

        // Navigation Logic
        function switchNav(id) {
            document.querySelectorAll('.section').forEach(s => s.classList.add('hidden'));
            document.getElementById(id).classList.remove('hidden');
            
            document.querySelectorAll('.nav-btn').forEach(btn => {
                btn.classList.remove('active');
                btn.classList.add('inactive');
            });
            document.getElementById('nav-' + id).classList.remove('inactive');
            document.getElementById('nav-' + id).classList.add('active');

            if(id === 'admin') renderAttendance();
            if(id === 'home') updateStats();
            if(id === 'scan') {
                startScanner();
                renderRecentScansTable();
            } else {
                stopScanner();
            }
        }

        // Register Logic
        function registerUser() {
            const name = document.getElementById('reg-name').value;
            const role = document.getElementById('reg-role').value;
            if(!name) return alert('Mohon isi Nama Lengkap.');

            const id = 'GKPS-' + Date.now();
            const newUser = { id, name, role, avatar: selectedAvatar };
            users.push(newUser);
            localStorage.setItem('gkps_users', JSON.stringify(users));

            const resultSection = document.getElementById('id-card-result');
            resultSection.classList.remove('hidden');
            resultSection.scrollIntoView({ behavior: 'smooth' });

            document.getElementById('card-name').innerText = name;
            document.getElementById('card-role').innerText = role;
            document.getElementById('card-avatar').src = selectedAvatar;
            
            // Barcode generation - clean and professional
            JsBarcode("#barcode", id, { format: "CODE128", width: 3, height: 80, displayValue: true, fontSize: 16, margin: 0, lineColor: "#1e293b", background: "transparent", font: "Poppins" });
            document.getElementById('reg-name').value = '';
        }

        // Scanner Logic
        let html5QrcodeScanner;
        function startScanner() {
            if(html5QrcodeScanner) return;
            html5QrcodeScanner = new Html5QrcodeScanner("reader", { fps: 10, qrbox: 280, aspectRatio: 1.0 });
            html5QrcodeScanner.render((decodedText) => { processAttendance(decodedText); }, (errorMessage) => {});
        }

        function stopScanner() {
            if(html5QrcodeScanner) {
                html5QrcodeScanner.clear().then(() => { html5QrcodeScanner = null; }).catch(error => { console.error("Failed to clear scanner", error); });
            }
        }

        function processAttendance(barcodeId) {
            const user = users.find(u => u.id === barcodeId);
            const resultDiv = document.getElementById('scan-result');
            resultDiv.classList.remove('hidden');

            if(user) {
                const now = new Date();
                const timeStr = now.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
                const dateStr = now.toLocaleDateString();

                const already = attendance.find(a => a.id === barcodeId && a.date === dateStr);
                if(already) {
                    // Professional Warning Style
                    resultDiv.className = "mt-6 text-center p-5 font-bold text-lg rounded-xl shadow-md transition-all bg-yellow-50 text-yellow-800 border-2 border-yellow-200";
                    resultDiv.innerHTML = `⚠️ <span class="font-extrabold">${user.name}</span> sudah absen tadi pukul ${already.time}.`;
                } else {
                    attendance.push({ id: barcodeId, name: user.name, role: user.role, time: timeStr, date: dateStr, avatar: user.avatar });
                    localStorage.setItem('gkps_attendance', JSON.stringify(attendance));
                    // Professional Success Style
                    resultDiv.className = "mt-6 text-center p-5 font-bold text-lg rounded-xl shadow-md transition-all bg-green-50 text-green-800 border-2 border-green-200";
                    resultDiv.innerHTML = `✅ Berhasil! Selamat Datang, <span class="font-extrabold">${user.name}</span>.`;
                    renderRecentScansTable();
                }
            } else {
                // Professional Error Style
                resultDiv.className = "mt-6 text-center p-5 font-bold text-lg rounded-xl shadow-md transition-all bg-red-50 text-red-800 border-2 border-red-200";
                resultDiv.innerHTML = `❌ Barcode tidak terdaftar dalam sistem.`;
            }
             setTimeout(() => { resultDiv.classList.add('hidden'); }, 4000);
        }

        // Admin & Stats Logic
        function renderAttendance() {
            const tbody = document.getElementById('attendance-table-body');
            tbody.innerHTML = '';
            if(attendance.length === 0) {
                tbody.innerHTML = '<tr><td colspan="3" class="text-center py-8 text-gray-400 italic font-medium bg-gray-50 rounded-b-xl">Belum ada data absensi.</td></tr>';
                return;
            }
            attendance.slice().reverse().forEach(record => {
                const roleClass = record.role === 'Guru' ? 'role-guru' : 'role-anak';
                tbody.innerHTML += `
                    <tr class="transition-all">
                        <td class="flex items-center">
                             <img src="${record.avatar || 'https://api.dicebear.com/7.x/adventurer/svg?seed=default'}" class="w-10 h-10 rounded-full mr-4 border-2 border-white shadow-sm bg-gray-100">
                            <span class="text-lg font-semibold text-gray-800">${record.name}</span>
                        </td>
                        <td>
                            <span class="role-badge ${roleClass}">
                                ${record.role}
                            </span>
                        </td>
                        <td class="text-gray-600 font-medium font-mono">${record.date} - ${record.time}</td>
                    </tr>
                `;
            });
        }

        function updateStats() {
            const today = new Date().toLocaleDateString();
            const todayAttendance = attendance.filter(a => a.date === today);
            document.getElementById('stat-count').innerText = todayAttendance.length;

            const avatarsContainer = document.getElementById('today-avatars-list');
            avatarsContainer.innerHTML = '';
            
            if(todayAttendance.length > 0) {
                const uniqueAvatars = [...new Map(todayAttendance.map(item => [item.avatar, item])).values()];
                uniqueAvatars.slice(0, 12).forEach((record, index) => {
                     const img = document.createElement('img');
                     img.src = record.avatar;
                     img.className = "w-12 h-12 rounded-full border-2 border-white shadow-sm bg-white hover:scale-110 transition-transform cursor-pointer tooltip";
                     img.title = record.name;
                     avatarsContainer.appendChild(img);
                });
                if(todayAttendance.length > 12) {
                     const more = document.createElement('span');
                     more.className = "flex items-center justify-center w-12 h-12 rounded-full bg-blue-100 text-blue-600 font-bold text-sm border-2 border-white shadow-sm";
                     more.innerText = `+${todayAttendance.length - 12}`;
                     avatarsContainer.appendChild(more);
                }
            } else {
                 avatarsContainer.innerHTML = '<span class="text-gray-400 font-medium italic bg-gray-50 px-4 py-2 rounded-xl">Menunggu kehadiran pertama hari ini...</span>';
            }
        }

        function renderRecentScansTable() {
            const today = new Date().toLocaleDateString();
            const recentTbody = document.getElementById('recent-scan-table');
            recentTbody.innerHTML = '';
            const todayTodays = attendance.filter(a => a.date === today).reverse().slice(0, 6);
            if(todayTodays.length === 0) {
                 recentTbody.innerHTML = '<tr><td class="text-gray-400 font-medium italic py-6 text-center bg-gray-50 rounded-xl">Belum ada yang scan hari ini.</td></tr>';
            } else {
                todayTodays.forEach(record => {
                    const roleClass = record.role === 'Guru' ? 'bg-blue-100 text-blue-800' : 'bg-green-100 text-green-800';
                    recentTbody.innerHTML += `
                        <tr class="hover:bg-blue-50 transition"><td class="py-4 px-2 flex items-center justify-between">
                            <div class="flex items-center">
                                <img src="${record.avatar}" class="w-12 h-12 rounded-full mr-4 border-2 border-white shadow-sm bg-gray-100">
                                <div>
                                    <div class="font-bold text-gray-800 text-lg">${record.name}</div>
                                    <div class="text-sm text-gray-500 font-medium"><span class="font-mono">${record.time}</span></div>
                                </div>
                            </div>
                            <span class="px-3 py-1 rounded-full text-xs font-bold ${roleClass}">${record.role}</span>
                        </td></tr>
                    `;
                });
            }
        }

        function exportData() {
            let csv = "NAMA,PERAN,TANGGAL,JAM\n";
            attendance.forEach(row => { csv += `"${row.name}","${row.role}","${row.date}","${row.time}"\n`; });
            const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.setAttribute('href', url);
            a.setAttribute('download', `Absensi_GKPS_${new Date().toLocaleDateString().replace(/\//g, '-')}.csv`);
            a.click();
        }

        function clearAttendance() {
            if(confirm('PERINGATAN: Tindakan ini akan menghapus SEMUA data absensi. Lanjutkan?')) {
                attendance = []; localStorage.setItem('gkps_attendance', JSON.stringify(attendance)); renderAttendance(); updateStats();
            }
        }

        // Init Landing Page
        switchNav('home');
    </script>
</body>
</html>
